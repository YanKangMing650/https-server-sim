# 【详细设计文档检视报告】模块联调设计

**版本**: v1
**创建日期**: 2026-02-20
**检视模块**: 模块联调设计

---

## 检视概述

| 项目 | 内容 |
|-----|------|
| 检视模块名称 | 模块联调设计 |
| 输入文件 | 架构设计文档、4+1视图、工程设计、各模块详细设计文档、现有代码 |
| 检视范围 | lld-模块联调设计.md 所有章节 |
| 检视依据 | 架构设计文档、各模块详细设计文档、现有代码实现 |

---

## 评分

| 项目 | 满分 | 扣分 | 得分 |
|-----|------|------|------|
| 文档结构完整性 | 15 | 0 | 15 |
| 架构一致性 | 30 | 8 | 22 |
| 落地可行性 | 25 | 10 | 15 |
| 文档清晰度 | 15 | 2 | 13 |
| 图形准确性 | 15 | 3 | 12 |
| **总分** | **100** | **23** | **77** |

---

## 核心问题清单

| 问题 ID | 问题所属维度 | 问题严重程度 | 问题具体位置 | 问题详细描述 | 针对性修改建议 |
|---------|-------------|-------------|-------------|-------------|---------------|
| **LDD-INT-001** | 架构一致性-职责边界 | 严重 | 2.3 初始化顺序 | 初始化顺序中包含"创建ProtocolHandler"等应由其他模块负责的内容，联调文档不应定义具体模块的内部创建逻辑，这属于各模块详细设计范畴 | 删除初始化顺序中涉及单个模块内部创建细节的描述，仅保留模块级别的初始化顺序 |
| **LDD-INT-002** | 架构一致性-职责边界 | 严重 | 3.1 HTTPS请求响应完整流程时序图 | 时序图中存在多处与现有代码/详细设计不一致：<br>1. Server创建ProtocolHandler（应由Connection持有）<br>2. EventLoop直接调用DebugChain和Callback（模块职责划分不清晰）<br>3. 未体现Event的handler机制 | 对照各模块详细设计文档和现有代码，修正时序图中的交互主体和调用流程，确保符合架构定义的职责边界 |
| **LDD-INT-003** | 落地可行性-接口契约 | 严重 | 4. 模块接口契约 | 接口契约中的伪代码与现有代码/详细设计不一致：<br>1. Server::handle_accept_event()在现有设计中不存在<br>2. ConnectionManager::create_connection()返回值类型不一致（现有代码返回裸指针，联调文档返回shared_ptr）<br>3. 多处接口签名与现有头文件不匹配 | 对照现有头文件（codes/core/**/*.hpp）和各模块详细设计文档，修正接口契约中的所有伪代码，确保与实际接口一致 |
| **LDD-INT-004** | 落地可行性-数据结构 | 一般 | 5.1 Connection对象的生命周期管理 | 与Connection模块详细设计不一致：<br>ConnectionManager::get_connection()在现有设计中返回裸指针，联调文档建议返回shared_ptr | 明确说明实际代码的生命周期管理方式，或建议修改代码以匹配文档，二者需保持一致 |
| **LDD-INT-005** | 文档清晰度-术语不统一 | 一般 | 全文 | 多处术语与现有代码不统一：<br>1. 模块名称：MsgCenter vs msg_center<br>2. 类名命名不一致<br>3. 部分方法名与实际代码不匹配 | 统一所有术语、类名、方法名，确保与现有代码和各模块详细设计文档保持一致 |
| **LDD-INT-006** | 图形准确性-时序图 | 严重 | 图1：HTTPS请求响应完整流程 | 时序图中多处与实际设计不符：<br>1. 缺少MsgCenter门面类，直接访问IOThread/EventLoop<br>2. Server创建ProtocolHandler并调用set_protocol_handler（Connection应负责）<br>3. 未体现Event::handler机制 | 基于各模块详细设计文档重新绘制时序图，确保：<br>1. 通过MsgCenter统一访问<br>2. 正确体现Connection持有ProtocolHandler<br>3. 使用Event::handler机制处理事件 |
| **LDD-INT-007** | 架构一致性-过度设计 | 一般 | 全文 | 联调文档中包含了大量本应属于各模块详细设计的内容，如具体类的内部方法实现细节、数据结构定义等，有过度设计嫌疑 | 精简联调文档，聚焦于**模块间交互**，删除单个模块内部实现细节的描述，这些内容应在各模块详细设计中定义 |
| **LDD-INT-008** | 落地可行性-测试用例 | 一般 | 8. 联调测试用例 | 测试用例过于笼统，缺少具体的：<br>1. 输入参数（如具体的请求报文、配置）<br>2. 预期输出（如具体的响应报文、状态码）<br>3. 验收标准（如何判断通过） | 补充测试用例的具体细节，使其可执行，每个用例应包含明确的前置条件、输入数据、预期输出、验收标准 |
| **LDD-INT-009** | 文档清晰度-内容模糊 | 一般 | 6. 集成风险识别 | 风险识别过于笼统，缺少：<br>1. 具体的风险触发条件<br>2. 明确的缓解措施责任人/模块<br>3. 风险等级划分 | 细化风险识别内容，补充每个风险的触发条件、缓解措施的责任方、风险等级（高/中/低） |
| **LDD-INT-010** | 图形准确性-依赖关系图 | 一般 | 2.1 依赖关系图 | 依赖关系图中部分依赖关系不准确：<br>1. Protocol依赖Callback（架构中Protocol不直接依赖Callback）<br>2. Server依赖Protocol（Server应通过Connection依赖Protocol） | 对照架构设计文档和4+1视图中的包依赖图，修正模块依赖关系图 |

---

## 整体评价

### 合规项
1. 文档结构完整，包含了模块联调所需的主要章节
2. 核心交互流程的设计思路清晰，覆盖了主要场景
3. 联调步骤与Checklist划分合理，便于分阶段验证
4. 尝试覆盖了初始化、请求响应、优雅关闭等关键流程

### 待改进项
1. **架构一致性**：多处与现有代码和各模块详细设计不一致，需重点修正
2. **落地可行性**：接口契约与实际代码不匹配，测试用例不够具体
3. **图形准确性**：时序图和依赖关系图需大幅修正
4. **过度设计**：包含过多单模块内部实现细节

### 落地性评估
修正所有问题后，文档可指导模块联调工作，但建议先与现有代码和各模块详细设计文档对齐，再进行二次检视。

---

## 修改建议总纲

### 修改优先级
1. **致命/严重问题优先**：LDD-INT-001、LDD-INT-002、LDD-INT-003、LDD-INT-006
2. **一般问题其次**：其他问题

### 修改核心方向
1. **架构一致性维度**：对照各模块详细设计文档和现有代码，确保职责边界清晰，接口定义一致
2. **落地可行性维度**：确保接口契约与实际代码一致，测试用例具体可执行
3. **文档清晰度维度**：统一术语，精简过度设计内容
4. **图形准确性维度**：重新绘制时序图和依赖关系图，确保与文字描述一致

### 二次检视提示
修改完成后，需重点检视：
1. 所有接口契约是否与现有头文件一致
2. 时序图是否符合各模块详细设计的职责划分
3. 是否删除了过度设计的内容，聚焦于模块间交互

---

**文档结束**
