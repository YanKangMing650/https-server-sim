# 【详细设计文档检视报告】模块联调设计

**检视模块名称**: 模块联调设计
**检视日期**: 2026-02-20
**版本**: 第6版

---

## 1. 检视概述

### 检视信息
- **检视模块**: 模块联调设计 (lld-模块联调设计.md)
- **输入文件**:
  - 架构设计文档: `docs/design/hld-架构设计文档.md`
  - 模块联调设计文档: `docs/design/lld-模块联调设计.md`
  - 现有代码实现: `codes/core/`
  - 集成测试用例: `codes/core/test/integration_tests/`
- **检视范围**: 文档所有章节
- **检视依据**: 架构设计文档、现有代码实现

---

## 2. 评分结果

| 维度 | 满分 | 扣分 | 得分 | 说明 |
|-----|------|------|------|------|
| 架构一致性 | 30 | -10 | 20 | 存在与实际代码不符的设计规划内容 |
| 落地可行性 | 30 | -8 | 22 | 部分契约描述与实际代码存在偏差 |
| 文档清晰度 | 25 | -3 | 22 | 部分描述不够明确 |
| 图形准确性 | 15 | -5 | 10 | 时序图包含未实现流程 |
| **总分** | **100** | **-26** | **74** | |

---

## 3. 核心问题清单

| 问题 ID | 问题所属维度 | 问题严重程度 | 问题具体位置 | 问题详细描述 | 针对性修改建议 |
|---------|-------------|-------------|-------------|-------------|---------------|
| MJT-001 | 架构一致性 - 职责边界 | 严重 | 2.3 初始化顺序、3.1 时序图 | 文档多处标注"DebugChain、CallbackStrategy初始化"为设计规划，当前代码未实现，但在接口汇总表和时序图中作为正常流程展示 | 明确区分"已实现"和"设计规划"两部分，或将设计规划内容移至单独的"未来规划"章节 |
| MJT-002 | 落地可行性 - 接口契约 | 严重 | 4. 模块间接口汇总表 | 接口表中包含多个当前代码未实现的接口（如 DebugChain::process_request()、CallbackStrategyManager::invoke_*_callback()、ProtocolHandler::send_response()） | 将接口表分为"已实现接口"和"规划接口"两个表格，或在备注列明确标注实现状态 |
| MJT-003 | 图形准确性 - 时序图 | 严重 | 3.1 HTTPS请求响应完整流程 | 时序图包含 DebugChain、CallbackStrategyManager 的调用流程，这些在当前代码中未实现 | 在时序图中用虚线或不同颜色标注未实现部分，或拆分为"当前实现"和"目标设计"两个图 |
| MJT-004 | 文档清晰度 - 术语统一 | 一般 | 全文 | "CallbackStrategyManager" 在架构设计文档中称为 "CallbackRegistry"，命名不统一 | 统一命名，与架构文档保持一致（CallbackRegistry） |
| MJT-005 | 落地可行性 - 测试用例 | 一般 | 10. 联调测试用例 | 测试用例 4、5 对应未实现模块（DebugChain、Callback），与实际集成测试文件不完全对应 | 调整测试用例章节，优先覆盖已有的集成测试用例（test_server_startup.cpp、test_connection_manager.cpp、test_event_flow.cpp） |
| MJT-006 | 文档清晰度 - 内容描述 | 一般 | 8.3 跨模块调用锁策略 | 提到"具体锁获取顺序在实际代码中未明确约定"，但此内容对联调指导意义不大 | 删除此句，或补充实际代码中已有的锁使用约定 |
| MJT-007 | 架构一致性 - 依赖关系 | 一般 | 2.1 依赖关系图 | 图中显示 Server 直接依赖 Callback，实际代码中 Server 不持有 Callback 成员 | 修改依赖图，移除 Server 到 Callback 的直接依赖，或标注为规划中 |
| MJT-008 | 落地可行性 - 接口契约 | 一般 | 5.7 WorkerPool与CallbackStrategyManager | 代码示例中使用了 `saved_response_data` 等未定义变量，实际代码中 CALLBACK_DONE 事件处理也未实现 | 修改代码示例，使其与实际代码保持一致，或明确标注为设计示例 |

---

## 4. 整体评价

### 合规项
1. **初始化流程准确**：Server::init() 和 Server::start() 的流程描述与 `server.cpp` 实际代码一致
2. **Event机制描述清晰**：Event结构、事件流转、MsgCenter职责与实际代码相符
3. **Connection生命周期管理**：shared_ptr管理、状态机定义与实际代码一致
4. **集成测试用例映射**：10.1节映射表与 `integration_tests/` 目录下文件对应关系正确
5. **线程安全约定合理**：8.1节各模块线程安全保证与代码实现基本一致

### 待改进项
1. **过度设计内容较多**：DebugChain、Callback模块的设计规划内容占比较大，容易误导开发
2. **实现状态标注不明确**：多处设计规划与已实现内容混在一起，缺少清晰区分
3. **与架构文档命名不一致**：CallbackStrategyManager vs CallbackRegistry

### 落地性评估
**修正所有问题后，文档可直接指导开发落地**。当前文档主体内容（Server、Connection、MsgCenter、Config模块交互）与实际代码一致，但需清理过度设计内容。

---

## 5. 修改建议总纲

### 修改优先级
1. **高优先级（致命/严重问题）**：MJTO-001、MJT-002、MJT-003
2. **中优先级（一般问题）**：MJT-004、MJT-007、MJT-008
3. **低优先级（优化项）**：MJT-005、MJT-006

### 修改核心方向
1. **架构一致性**：明确区分"已实现"和"设计规划"，避免混淆
2. **落地可行性**：接口汇总表、代码示例与实际代码对齐
3. **文档清晰度**：统一命名，清晰标注实现状态

### 二次检视提示
修改完成后，重点检视：
1. 设计规划内容是否已合理隔离
2. 接口表与代码头文件的一致性
3. 时序图与实际流程的一致性

---

**文档结束**
