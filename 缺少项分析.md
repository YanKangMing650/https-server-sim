# HTTPS Server 模拟器 - 缺少项分析文档

**版本**: v1
**创建日期**: 2026-02-20
**状态**: 草稿

---

## 目录

1. [概述](#1-概述)
2. [文档方面缺少项](#2-文档方面缺少项)
3. [代码实现方面缺少项](#3-代码实现方面缺少项)
4. [优先级建议](#4-优先级建议)

---

## 1. 概述

本文档基于架构设计文档（HLD）、4+1视图、工程设计文档，对比当前代码实现，分析缺少的内容。

当前状态：
- ✅ 各核心模块已实现并通过UT
- ❌ 模块集成/联调相关代码未实现
- ❌ API适配层未实现
- ❌ 集成测试未实现
- ❌ 部分文档缺失

---

## 2. 文档方面缺少项

| 序号 | 文档名称 | 建议路径 | 说明 | 参考架构设计文档位置 |
|-----|---------|---------|------|------------------|
| 2.1 | 集成测试设计文档 | `docs/design/lld-集成测试设计.md` | 描述集成测试的范围、用例、方法 | hld-工程设计.md 第8节 |
| 2.2 | 模块联调设计文档 | `docs/design/lld-模块联调设计.md` | 描述各模块之间的接口、交互流程、数据流向 | hld-4+1视图.md 第3节 |
| 2.3 | API接口文档 | `docs/design/api-接口文档.md` | 详细描述C接口和C++接口的参数、返回值、错误码 | hld-架构设计文档.md 第4节 |
| 2.4 | 联调测试计划 | `docs/test/联调测试计划.md` | 联调阶段的测试计划、用例、验收标准 | - |
| 2.5 | 部署文档 | `docs/user_guide/部署文档.md` | 描述如何部署和配置整个系统 | hld-工程设计.md 第7节 |

---

## 3. 代码实现方面缺少项

### 3.1 API适配层（api/adapt）

架构设计文档位置：hld-架构设计文档.md 第4节、hld-工程设计.md 第2节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.1.1 | `codes/api/adapt/CMakeLists.txt` | adapt层构建配置 | ❌ 缺失 |
| 3.1.2 | `codes/api/adapt/include/server_adapt.h` | C接口头文件 | ❌ 缺失 |
| 3.1.3 | `codes/api/adapt/include/server_adapt.hpp` | C++ ServerAdapt类定义 | ❌ 缺失 |
| 3.1.4 | `codes/api/adapt/source/server_adapt.cpp` | ServerAdapt实现 | ❌ 缺失 |
| 3.1.5 | `codes/api/adapt/source/internal.hpp` | 内部头文件 | ❌ 缺失 |

**接口定义**（参考hld-架构设计文档.md 第4.1-4.2节）：
```c
// server_adapt.h 需包含：
- ServerStatusEnum 枚举
- ServerStatus 结构体
- Statistics 结构体
- server_adapt_create()
- server_adapt_destroy()
- server_adapt_init()
- server_adapt_start()
- server_adapt_stop()
- server_adapt_get_status()
- server_adapt_get_statistics()
- server_adapt_cleanup()
```

### 3.2 Python CLI适配层（api/cli）

架构设计文档位置：hld-架构设计文档.md 第2节、hld-工程设计.md 第2节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.2.1 | `codes/api/cli/__init__.py` | Python包初始化 | ❌ 缺失 |
| 3.2.2 | `codes/api/cli/main.py` | CLI入口 | ❌ 缺失 |
| 3.2.3 | `codes/api/cli/config.py` | 配置处理 | ❌ 缺失 |
| 3.2.4 | `codes/api/cli/server.py` | Server控制 | ❌ 缺失 |

### 3.3 Python GUI适配层（api/app）

架构设计文档位置：hld-架构设计文档.md 第2节、hld-工程设计.md 第2节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.3.1 | `codes/api/app/__init__.py` | Python包初始化 | ❌ 缺失 |
| 3.3.2 | `codes/api/app/main.py` | GUI入口 | ❌ 缺失 |
| 3.3.3 | `codes/api/app/main_window.py` | 主窗口 | ❌ 缺失 |
| 3.3.4 | `codes/api/app/config_panel.py` | 配置面板 | ❌ 缺失 |
| 3.3.5 | `codes/api/app/log_panel.py` | 日志面板 | ❌ 缺失 |

### 3.4 Core层集成测试

架构设计文档位置：hld-工程设计.md 第8节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.4.1 | `codes/core/test/integration_tests/CMakeLists.txt` | 集成测试构建配置 | ❌ 缺失 |
| 3.4.2 | `codes/core/test/integration_tests/test_server_startup.cpp` | Server启动测试 | ❌ 缺失 |
| 3.4.3 | `codes/core/test/integration_tests/test_https_request.cpp` | HTTPS请求响应测试 | ❌ 缺失 |
| 3.4.4 | `codes/core/test/integration_tests/test_concurrent_connections.cpp` | 并发连接测试 | ❌ 缺失 |
| 3.4.5 | `codes/core/test/integration_tests/test_callback_flow.cpp` | 回调流程测试 | ❌ 缺失 |

### 3.5 Core层测试工具

架构设计文档位置：hld-工程设计.md 第8.4节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.5.1 | `codes/core/test/tools/CMakeLists.txt` | 工具构建配置 | ❌ 缺失 |
| 3.5.2 | `codes/core/test/tools/cert_generator.cpp` | 证书生成工具 | ❌ 缺失 |
| 3.5.3 | `codes/core/test/tools/stress_test.cpp` | 压力测试工具 | ❌ 缺失 |
| 3.5.4 | `codes/core/test/tools/benchmark.cpp` | 性能基准测试工具 | ❌ 缺失 |

### 3.6 测试用Client模拟器

架构设计文档位置：hld-工程设计.md 第8.5节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.6.1 | `codes/core/test/sim_client/__init__.py` | Python包初始化 | ❌ 缺失 |
| 3.6.2 | `codes/core/test/sim_client/main.py` | 入口 | ❌ 缺失 |
| 3.6.3 | `codes/core/test/sim_client/config.py` | 配置处理（JSON Schema） | ❌ 缺失 |
| 3.6.4 | `codes/core/test/sim_client/client.py` | Client实现 | ❌ 缺失 |
| 3.6.5 | `codes/core/test/sim_client/scenario.py` | 场景定义 | ❌ 缺失 |

### 3.7 回调Objects

架构设计文档位置：hld-架构设计文档.md 第2节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.7.1 | `callbacks/CMakeLists.txt` | 回调构建配置 | ❌ 缺失 |
| 3.7.2 | `callbacks/callback_1.cpp` | 回调示例1 | ❌ 缺失 |
| 3.7.3 | `callbacks/callback_2.cpp` | 回调示例2 | ❌ 缺失 |

### 3.8 CMake构建系统重构

架构设计文档位置：hld-工程设计.md 第5节

当前CMakeLists.txt需要按照工程设计文档重构：

| 序号 | 文件/目录 | 说明 | 当前状态 | 目标状态 |
|-----|---------|------|---------|--------|
| 3.8.1 | `codes/CMakeLists.txt` | 顶层CMakeLists | ⚠️ 简化版 | ❌ 需要重构 |
| 3.8.2 | `codes/core/CMakeLists.txt` | Core聚合CMakeLists | ⚠️ 存在但不符合规范 | ❌ 需要重构 |
| 3.8.3 | `codes/core/utils/CMakeLists.txt` | utils模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.4 | `codes/core/config/CMakeLists.txt` | config模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.5 | `codes/core/callback/CMakeLists.txt` | callback模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.6 | `codes/core/msg_center/CMakeLists.txt` | msg_center模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.7 | `codes/core/debug_chain/CMakeLists.txt` | debug_chain模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.8 | `codes/core/protocol/CMakeLists.txt` | protocol模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.9 | `codes/core/connection/CMakeLists.txt` | connection模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.10 | `codes/core/server/CMakeLists.txt` | server模块CMakeLists | ❌ 缺失 | ❌ 需要创建 |
| 3.8.11 | `codes/core/core_dummy.cpp` | Core聚合占位文件 | ❌ 缺失 | ❌ 需要创建 |

**重构要求**（参考hld-工程设计.md 第5节）：
- 每个子模块先编译为独立静态库（`hs_<module>_static`）
- 每个子模块有独立单元测试
- Core整体聚合为动态库（`libhttps_server_core.so`）
- 按依赖顺序构建：utils → config → callback → msg_center → debug_chain → protocol → connection → server

### 3.9 回调接口C头文件

架构设计文档位置：hld-架构设计文档.md 第4.3节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.9.1 | `codes/core/callback/include/callback/callback.h` | C接口回调定义 | ❌ 缺失 |

**需定义**（参考hld-架构设计文档.md 第4.3节）：
```c
- ClientContext 结构体
- AsyncParseContentFunc 函数类型
- AsyncReplyContentFunc 函数类型
- CallbackStrategy 结构体
- CallbackRegistry 相关C接口
```

### 3.10 调测点扩展接口C头文件

架构设计文档位置：hld-架构设计文档.md 第4.4节

| 序号 | 文件/目录 | 说明 | 状态 |
|-----|---------|------|------|
| 3.10.1 | `codes/core/debug_chain/include/debug_chain/debug_handler.h` | 调测点C接口定义 | ❌ 缺失 |

**需定义**（参考hld-架构设计文档.md 第4.4节）：
```c
- DebugHandler 结构体
- DebugHandlerRegistry 相关C接口
```

---

## 4. 优先级建议

### 4.1 最高优先级（联调必需）

| 序号 | 项 | 说明 |
|-----|---|------|
| P0.1 | CMake构建系统重构 | 先把构建系统理顺，才能进行后续集成 |
| P0.2 | 回调接口C头文件 | 模块间交互需要 |
| P0.3 | Core层集成测试 | 验证模块间协作 |
| P0.4 | 模块联调设计文档 | 指导联调工作 |

### 4.2 高优先级（功能完整）

| 序号 | 项 | 说明 |
|-----|---|------|
| P1.1 | api/adapt层实现 | 对外C接口 |
| P1.2 | api/cli层实现 | 命令行界面 |
| P1.3 | 测试用Client模拟器 | 用于联调测试 |
| P1.4 | 集成测试设计文档 | 指导测试工作 |

### 4.3 中优先级（完善体验）

| 序号 | 项 | 说明 |
|-----|---|------|
| P2.1 | api/app层实现 | 图形界面 |
| P2.2 | 回调Objects示例 | 用户使用示例 |
| P2.3 | 测试工具 | 证书生成、压测等 |
| P2.4 | API接口文档 | 接口使用说明 |

### 4.4 低优先级（锦上添花）

| 序号 | 项 | 说明 |
|-----|---|------|
| P3.1 | 部署文档 | 生产部署指南 |
| P3.2 | 调测点扩展接口C头文件 | 扩展功能 |

---

## 附录

### 参考文档列表

| 文档 | 路径 |
|-----|------|
| 架构设计文档 | `docs/design/hld-架构设计文档.md` |
| 4+1视图 | `docs/design/hld-4+1视图.md` |
| 工程设计 | `docs/design/hld-工程设计.md` |

---

**文档结束**
